<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrawBoard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/static/styles/index.css">
    <script type="module">
        import init, {download_svg} from './pkg/vector_drawing_webapp.js';

        async function start() {
          await init();
          console.log("‚úÖ WebAssembly Initialized");

          // ‚úÖ Resize Canvas to Fit Screen
          function resizeCanvas() {
              const canvas = document.getElementById("drawing-canvas");
              const toolbar = document.getElementById("toobar");

              canvas.width = window.innerWidth - 260;
              canvas.height = window.innerHeight - 76;
          }

          window.addEventListener("resize", resizeCanvas);

          const exportButton = document.getElementById('export-btn');
          exportButton.addEventListener("click", () => {
            download_svg("shapes.svg")
          });
        }

        start();
      /*
        document.addEventListener("DOMContentLoaded", function () {
          const libraryPanel = document.getElementById("library-panel");
          let selectedItem = null;

          const canvas = document.getElementById("drawing-canvas");
          const ctx = canvas.getContext("2d");

          // üéØ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
          libraryPanel.addEventListener("dragover", (event) => {
              event.preventDefault();
              libraryPanel.classList.add("dragover");
          });

          libraryPanel.addEventListener("dragleave", () => {
              libraryPanel.classList.remove("dragover");
          });

          libraryPanel.addEventListener("drop", (event) => {
              event.preventDefault();
              libraryPanel.classList.remove("dragover");

              const files = event.dataTransfer.files;
              for (let i = 0; i < files.length; i++) {
                  const file = files[i];

                  if (file.type === "image/svg+xml") {
                      const reader = new FileReader();
                      reader.onload = function (e) {
                          addSvgToLibrary(e.target.result);
                      };
                      reader.readAsText(file);
                  } else {
                      alert("SVG ÌååÏùºÎßå ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.");
                  }
              }
          });

          // üéØ ÎùºÏù¥Î∏åÎü¨Î¶¨Ïóê SVG Ï∂îÍ∞Ä
          function addSvgToLibrary(svgData) {
            const item = document.createElement("div");
            item.classList.add("library-item");
            item.setAttribute("draggable", "true");
            item.setAttribute("data-src", svgData); // üéØ SVG ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•

            const img = document.createElement("img");
            img.src = "data:image/svg+xml," + encodeURIComponent(svgData);
            img.alt = "SVG Thumbnail";

            item.appendChild(img);

            // üéØ ÎìúÎûòÍ∑∏ ÏãúÏûë Ïù¥Î≤§Ìä∏
            item.addEventListener("dragstart", (event) => {
                event.dataTransfer.setData("text/plain", svgData);
            });

            // üéØ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÑ†ÌÉù ÏÉÅÌÉú Î≥ÄÍ≤Ω
            item.addEventListener("click", () => {
                if (selectedItem) {
                    selectedItem.classList.remove("selected");
                }
                selectedItem = item;
                selectedItem.classList.add("selected");
            });

            libraryPanel.appendChild(item);
          }

          // üéØ Delete ÌÇ§Î°ú ÏÑ†ÌÉùÎêú ÏïÑÏù¥ÌÖú ÏÇ≠Ï†ú
          document.addEventListener("keydown", (event) => {
              if (event.key === "Delete" || event.key === "Backspace") {
                  if (selectedItem) {
                      selectedItem.remove();
                      selectedItem = null;
                  }
              }
          });
        });
        */
    </script> 
</head>
<body>
    <div class="navbar">
        <span>DrawBoard</span>
    </div>
    <div class="toolbar">
        <button id="save-btn" title="Save"><i class="fas fa-save"></i></button>
        <button id="export-btn" title="Export"><i class="fas fa-download"></i></button>

		<div class="divider"></div>
        
        <button disabled title="Copy"><i class="fas fa-copy"></i></button>
        <button disabled title="Cut"><i class="fas fa-cut"></i></button>
        <button title="Paste"><i class="fas fa-paste"></i></button>
        
        <div class="divider"></div>
        
        <button id="fit-btn" title="fit">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 354 354" width="14" height="14">
                <path d="M307.4,17.2H46.6c-20.8,0-37.6,16.8-37.6,37.6v244.4c0,20.8,16.8,37.6,37.6,37.6h260.8c20.8,0,37.6-16.8,37.6-37.6V54.8c0-20.8-16.8-37.6-37.6-37.6ZM137,228.9l-31.6,31.6h6.2c3.9,0,7.5,1.6,10.1,4.2,2.6,2.6,4.2,6.1,4.2,10.1,0,7.9-6.4,14.2-14.2,14.2h-37.8c-.9.2-1.8.3-2.7.3-4,0-7.6-1.7-10.2-4.3-2.7-2.6-4.3-6.2-4.3-10.2,0-.9,0-1.9.3-2.7v-37.8c0-7.9,6.4-14.2,14.2-14.2,3.9,0,7.5,1.6,10.1,4.2,2.6,2.6,4.2,6.1,4.2,10.1v6.2l31.6-31.6c5.6-5.6,14.6-5.6,20.1,0,5.6,5.6,5.6,14.6,0,20.1ZM137,145.2c-5.6,5.6-14.6,5.6-20.1,0l-31.6-31.6v6.2c0,3.9-1.6,7.5-4.2,10.1-2.6,2.6-6.1,4.2-10.1,4.2-7.9,0-14.2-6.4-14.2-14.2v-37.8c-.2-.9-.3-1.8-.3-2.7,0-4,1.7-7.6,4.3-10.2,2.6-2.7,6.2-4.3,10.2-4.3.9,0,1.9,0,2.7.3h37.8c7.9,0,14.2,6.4,14.2,14.2,0,3.9-1.6,7.5-4.2,10.1-2.6,2.6-6.1,4.2-10.1,4.2h-6.2l31.6,31.6c5.6,5.6,5.6,14.6,0,20.1ZM293.2,285c-2.6,2.7-6.2,4.3-10.2,4.3-.9,0-1.9,0-2.7-.3h-37.8c-7.9,0-14.2-6.4-14.2-14.2,0-3.9,1.6-7.5,4.2-10.1s6.1-4.2,10.1-4.2h6.2l-31.6-31.6c-5.6-5.6-5.6-14.6,0-20.1,5.6-5.6,14.6-5.6,20.1,0l31.6,31.6v-6.2c0-3.9,1.6-7.5,4.2-10.1s6.1-4.2,10.1-4.2c7.9,0,14.2,6.4,14.2,14.2v37.8c.2.9.3,1.8.3,2.7,0,4-1.7,7.6-4.3,10.2ZM297.3,81.9v37.8c0,7.9-6.4,14.2-14.2,14.2-3.9,0-7.5-1.6-10.1-4.2s-4.2-6.1-4.2-10.1v-6.2l-31.6,31.6c-5.6,5.6-14.6,5.6-20.1,0-5.6-5.6-5.6-14.6,0-20.1l31.6-31.6h-6.2c-3.9,0-7.5-1.6-10.1-4.2s-4.2-6.1-4.2-10.1c0-7.9,6.4-14.2,14.2-14.2h37.8c.9-.2,1.8-.3,2.7-.3,4,0,7.6,1.7,10.2,4.3,2.7,2.6,4.3,6.2,4.3,10.2s0,1.9-.3,2.7Z"/>
            </svg>
        </button>
        <button id="clear-btn" title="Clear">
            <i class="fas fa-circle-xmark"></i>
        </button>

        <div class="divider"></div>
	  
        <button id="selection-mode" class="active" title="Selection">
            <i class="fas fa-mouse-pointer"></i>
        </button>
        <button id="eraser-mode" title="Eraser">
            <i class="fas fa-eraser"></i>
        </button>
        <button id="pencil-mode" title="Pencil">
            <i class="fas fa-pencil"></i> 
        </button>
        <button id="line-mode" title="Line">
            <i class="fas fa-ruler"></i>
        </button>

        <button id="polygon-mode" title="Polygon">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 354 354" width="14" height="14">
                <path d="M246.8,56.1l69.8,120.9-69.8,120.9H107.2l-69.8-120.9L107.2,56.1h139.6M263.5,27.1H90.5L3.9,177l86.5,149.9h173.1l86.5-149.9L263.5,27.1h0Z"/>
                <polygon points="90.5 27.1 3.9 177 90.5 326.9 177 326.9 177 27.1 90.5 27.1">
            </svg>    
        </button>
        <button id="rectangle-mode" title="Rectangle">
            <i class="fa-regular fa-square"></i>
        </button>
        <button id="ellipse-mode" title="Ellipse">
            <i class="fa-regular fa-circle"></i>
        </button>

	    <button id="arc-mode" title="Arc">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 354 354" width="14" height="14">
                <path d="M293.9,249.3c11.4,0,20.6,9.3,20.6,20.6s-9.3,20.6-20.6,20.6-20.6-9.3-20.6-20.6,9.3-20.6,20.6-20.6M293.9,219.3c-28,0-50.6,22.7-50.6,50.6s22.7,50.6,50.6,50.6,50.6-22.7,50.6-50.6-22.7-50.6-50.6-50.6h0Z"/>
                <path d="M60.1,249.3c11.4,0,20.6,9.3,20.6,20.6s-9.3,20.6-20.6,20.6-20.6-9.3-20.6-20.6,9.3-20.6,20.6-20.6M60.1,219.3c-28,0-50.6,22.7-50.6,50.6s22.7,50.6,50.6,50.6,50.6-22.7,50.6-50.6-22.7-50.6-50.6-50.6h0Z"/>
                <g>
                  <path class="st0" d="M171.3,103.7c2,.7,4.2,1,6.4,1s4.4-.4,6.4-1c-2.1-.2-4.3-.3-6.4-.3s-4.3.1-6.4.3Z"/>
                  <path class="st0" d="M168.2,65.8c3.2-.3,6.3-.4,9.5-.4s6.4.2,9.5.4c-2.9-1.5-6.1-2.4-9.5-2.4s-6.7.9-9.5,2.4Z"/>
                  <path d="M127.4,78.2c-17.7,9.5-33.7,24.1-47.3,43.3-24.2,34.2-37.5,79.3-37.5,127.1h38c0-40,10.8-77.3,30.5-105.2,8.1-11.5,17.3-20.7,27.2-27.4-7.1-8.7-11.4-19.8-11.4-31.9s.1-3.9.3-5.8Z"/>
                  <path d="M275.2,121.5c-13.5-19.2-29.6-33.8-47.3-43.3.2,1.9.3,3.9.3,5.8,0,12.1-4.3,23.2-11.4,31.9,9.9,6.7,19.1,15.9,27.2,27.4,19.7,27.8,30.5,65.2,30.5,105.2h38c0-47.8-13.3-92.9-37.5-127.1Z"/>
                  <path d="M177.7,63.4c3.4,0,6.7.9,9.5,2.4,14.2,1.3,27.9,5.5,40.8,12.4-2.9-25.2-24.3-44.8-50.3-44.8s-47.4,19.6-50.3,44.8c12.9-6.9,26.6-11.1,40.8-12.4,2.9-1.5,6.1-2.4,9.5-2.4Z"/>
                  <path d="M177.7,104.7c-2.2,0-4.4-.4-6.4-1-11.4,1.1-22.5,5.4-32.9,12.3,9.3,11.4,23.4,18.7,39.3,18.7s30-7.3,39.3-18.7c-10.4-7-21.5-11.2-32.9-12.3-2,.7-4.2,1-6.4,1Z"/>
                  <path d="M157.1,84.1c0-7.9,4.5-14.8,11.1-18.3-14.2,1.3-27.9,5.5-40.8,12.4-.2,1.9-.3,3.9-.3,5.8,0,12.1,4.3,23.2,11.4,31.9,10.4-7,21.5-11.2,32.9-12.3-8.2-2.7-14.2-10.5-14.2-19.6Z"/>
                  <path d="M228,78.2c-12.9-6.9-26.6-11.1-40.8-12.4,6.6,3.4,11.1,10.3,11.1,18.3s-6,16.9-14.2,19.6c11.4,1.1,22.5,5.4,32.9,12.3,7.1-8.7,11.4-19.8,11.4-31.9s-.1-3.9-.3-5.8Z"/>
                </g>
            </svg>              
        </button>
		<button id="bezier-mode" title="Bezier">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 354 354" width="14" height="14">
                <path d="M293.9,249.3c11.4,0,20.6,9.3,20.6,20.6s-9.3,20.6-20.6,20.6-20.6-9.3-20.6-20.6,9.3-20.6,20.6-20.6M293.9,219.3c-28,0-50.6,22.7-50.6,50.6s22.7,50.6,50.6,50.6,50.6-22.7,50.6-50.6-22.7-50.6-50.6-50.6h0Z"/>
                <path d="M60.1,249.3c11.4,0,20.6,9.3,20.6,20.6s-9.3,20.6-20.6,20.6-20.6-9.3-20.6-20.6,9.3-20.6,20.6-20.6M60.1,219.3c-28,0-50.6,22.7-50.6,50.6s22.7,50.6,50.6,50.6,50.6-22.7,50.6-50.6-22.7-50.6-50.6-50.6h0Z"/>
                <path class="st0" d="M169.1,65.3h17.2c-2.6-1.2-5.5-1.9-8.6-1.9s-6,.7-8.6,1.9Z"/>
                <path class="st0" d="M171.3,103.7c2,.7,4.2,1,6.4,1s4.4-.4,6.4-1c-2.1-.2-4.3-.3-6.4-.3s-4.3.1-6.4.3Z"/>
                <path class="st0" d="M90.6,108.2c1.6-1.9,3.3-3.7,4.9-5.4h-1.9c-.9,1.9-1.9,3.7-3,5.4Z"/>
                <path class="st0" d="M259.9,102.8c.4.4.8.8,1.1,1.2-.2-.4-.4-.8-.6-1.2h-.5Z"/>
                <path d="M177.7,63.4c3.1,0,6,.7,8.6,1.9h38.4c-7.4-18.7-25.7-31.9-47-31.9s-39.6,13.2-47,31.9h38.4c2.6-1.2,5.5-1.9,8.6-1.9Z"/>
                <path d="M177.7,104.7c-2.2,0-4.4-.4-6.4-1-11.4,1.1-22.5,5.4-32.9,12.3,9.3,11.4,23.4,18.7,39.3,18.7s30-7.3,39.3-18.7c-10.4-7-21.5-11.2-32.9-12.3-2,.7-4.2,1-6.4,1Z"/>
                <path d="M344.5,84.1c0-24.4-19.8-44.1-44.1-44.1s-32.9,10.4-40,25.4h-35.7c2.3,5.8,3.6,12.1,3.6,18.7,0,12.1-4.3,23.2-11.4,31.9,9.9,6.7,19.1,15.9,27.2,27.4,19.7,27.8,30.5,65.2,30.5,105.2h38c0-47.8-13.3-92.9-37.5-127.1-.6-.8-1.2-1.7-1.8-2.5,7.5,5.8,16.8,9.2,26.9,9.2,24.4,0,44.1-19.8,44.1-44.1ZM259.9,102.8h.5c.2.4.4.8.6,1.2-.4-.4-.8-.8-1.1-1.2Z"/>
                <path d="M130.6,65.3h-37.1c-7-15-22.3-25.4-40-25.4S9.5,59.7,9.5,84.1s19.8,44.1,44.1,44.1,22.9-4.8,30.9-12.6c-1.5,1.9-2.9,3.9-4.4,5.9-24.2,34.2-37.5,79.3-37.5,127.1h38c0-40,10.8-77.3,30.5-105.2,8.1-11.5,17.3-20.7,27.2-27.4-7.1-8.7-11.4-19.8-11.4-31.9s1.3-12.9,3.6-18.7ZM90.6,108.2c1.1-1.7,2.1-3.5,3-5.4h1.9c-1.7,1.7-3.3,3.5-4.9,5.4Z"/>
                <path d="M224.7,65.3h-38.4c7.1,3.3,12,10.4,12,18.7s-6,16.9-14.2,19.6c11.4,1.1,22.5,5.4,32.9,12.3,7.1-8.7,11.4-19.8,11.4-31.9s-1.3-12.9-3.6-18.7Z"/>
                <path d="M157.1,84.1c0-8.3,4.9-15.5,12-18.7h-38.4c-2.3,5.8-3.6,12.1-3.6,18.7,0,12.1,4.3,23.2,11.4,31.9,10.4-7,21.5-11.2,32.9-12.3-8.2-2.7-14.2-10.5-14.2-19.6Z"/>
            </svg>              
        </button>

	  <div class="divider"></div>

      <select class="font-style">
		<option value="arial">Arial</option>
		<option>Verdana</option>
		<option>Times New Roman</option>
	  </select>
	  <input type="number" value="20" min="1" max="50" class="font-size" />
	  <button id="text-mode">üî§</button> <!-- ‚úÖ Added Text Input Button -->
	  <div class="divider"></div>

	  <input type="color" id="color-picker" value="#0000FF">
	  <select id="line-style" class="line-style">
		<option>Solid</option>
		<option>Dot</option>
		<option>Dash Dot</option>
	  </select>
	  <input type="range" id="line-width" min="1" max="10" value="2" class="line-size">
	  <div class="divider"></div>
	  <input type="color" id="fill-color" value="#FFFFFF">
		<i class="fas fa-fill-drip"></i>
		<span id="fillColorPreview" class="transparent" style="background-color: #FFFFFF;"></span>
	  </input>
		<button id="clear-fill">No Fill</button>
		<div class="divider"></div>
		<button><i class="fas fa-undo"></i> Undo</button>
		<button disabled><i class="fas fa-redo"></i> Redo</button>
    </div>
    <div class="main-container">
        <div class="panel" id="libraryPanel">
            <h5>Library Panel</h5>
            <p>Ïó¨Í∏∞Ïóê Ïã¨Î≥º Î™©Î°ùÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
        </div>
        <div class="splitter" id="splitter"></div>
        <div class="canvas">
            <!-- Ï∫îÎ≤ÑÏä§ -->
        <canvas id="drawing-canvas" width="1600" height="900"></canvas>
        <textarea id="hidden-input" style="position: absolute; opacity: 0; pointer-events: none;"></textarea>
        </div>
    </div>
    
    <script>
        const panel = document.getElementById('libraryPanel');
        const splitter = document.getElementById('splitter');
        const canvas = document.querySelector('.canvas');
        let isResizing = false;

        splitter.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
        });

        function resize(e) {
            if (isResizing) {
                let newWidth = e.clientX;
                let maxWidth = window.innerWidth - 100;
                if (newWidth > 200 && newWidth < maxWidth) {
                    panel.style.width = newWidth + 'px';
                }
            }
        }

        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>
</html>
